# Test

## 1. X-load

### Legend:

- ?_s2?: `SELECT ... INTO`
- ?_is?: `INSERT INTO ... SELECT`
- ?_??r[aw]: money = money
- ?_??s[um]: money = SUM(money) ... GROUP BY
+ 'turbo' = ?_s2s
+ 'simple' = ?_s2r
+ 'ins' = ?_isr

### Results:

\#    | T_ld | T_idx| T_all| DU_raw | DU_txo| DU_idx| DU_tmp| Records   |
------|-----:|-----:|-----:|-------:|------:|------:|------:|----------:|
2_s2s | 1148 |  124 | 1272 |  13446 |  1279 |  2297 | 13600 |  26231270 |
2_iss | *683*|   95 |  778 |  13446 |  1279 |  2297 |  3844 |  26231270 |
2_s2r |  665 |  383 | 1048 |  13446 |  2558 |  4492 |  3847 |  52356696 |
2_isr |  715 |  403 | 1118 |  13446 |  2558 |  4492 |  3844 |  52356696 |
4_s2s | 2560 |  611 | 3171 |  84725 | 10872 | 19199 | 82455 | 220965455 |
4_iss |*2586*|  856 | 3442 |  84725 | 10868 | 18954 | 23544 | 220965455 |
4_s2r | 3288 | 1387 | 4675 |  84725 | 16205 | 28377 | 72029 | 330788828 |
4_isr | 2250 | 1500 | 3750 |  84725 | 16205 | 28378 | 23556 | 330788828 |
i5_iss|*5074*| 1300 | 6374 | 205272 | 27261 | 49263 | 31422 | 566787845 |

raw+txo=232533
idxed: 281796

### Timing:

- 4_s2s: 66'06"+747"
- 4_iss: 43'06,
- 4_s2r: 59'57"
- 4_isr: 37'29"+25'01"
- 2_s2s: 23'56"+145"
- 2_iss: 17'36"

### Notes:

- du_raw: w/o txo
- du_txo: &Delta; base size right after import
- du_idx: &Delta; of idx only
- du_tmp: max size of $PGSQL/.../pgsql_tmp/ (~= txo+idx (excepting s2s))
- du_max: = du_raw+du_txo+du_tmp (4_s2s: 178035)
- txo: 51.6 bytes/rec (real=4+4+4+8=20)

## 2. Queries

### Legend:

- t: table
- v: view
- 2x:  250k @ i G3450   (2 x 3.4 GHz), HDD
- 4x:  400k @ i7-4790   (4 x 3.6 GHz), HDD
- a5x: 500k @ FX-4100   (4 x 3.8 GHz), SDD
- i5x: 500k @ E5-2650v2 (8 x 2.6 GHz), SDD

### Results:

*(_test250)*

Query         |  2t |  2v |   4t |   4v |  a5t |  a5v |  i5t |  i5v |
--------------|----:|----:|-----:|-----:|-----:|-----:|-----:|-----:|
raw\_sum_txo  |  17 |  17 |   98 |   80 |   98 |   97 |  141 |  133 |
raw_top       | 439 | 367 |  778 |  792 | 1093 | 1327 |  861 |  964 |
raw_utxo      | 634 | 592 | 1902 | 1918 | 4460 | 4493 | 3058 | 3139 |
txo\_sum_txo  |  10 | 461 |   65 |  906 |   80 | 2218 |   62 | 1257 |
txo_top       |   3 | 433 |    7 |  727 |   12 | 1321 |   15 |  775 |
txo_utxo      |  75 | 568 | 1124 | 3059 | 4999 | 6739 | 4166 | 4882 |
addr_gt       |  29 | 451 |    7 |  673 | ---- | ---- |   21 | ---- |
addr\_btc_max |  10 | 726 |   14 | 1435 |  116 | 3873 |   25 | 1888 |
addr\_btc_min |   6 | 811 |   14 | 1424 |  102 | 3823 |   25 | 2366 |
addr\_cnt_max |   6 | 744 |   15 | 1453 |   96 | 3823 |   25 | 2403 |
addr\_cnt_min |   6 | 827 |   15 | 1436 |  103 | 3875 |   25 | 2021 |
alist\_btc_gt |   4 | 783 |   12 | 1443 |   45 | 3847 |   24 | 2503 |
alist\_btc_lt |   4 | 760 |   12 | 1431 |   44 | 3772 |   24 | 2084 |
alist\_cnt_gt |   4 | 734 |   12 | 1451 |   45 | 3831 |   24 | 2420 |
alist\_cnt_lt |   4 | 770 |   12 | 1446 |   45 | 3771 |   24 | 2455 |
alist_moves   |   5 | 767 |   13 | 1439 |   90 | 3843 |   26 | 2260 |

## 3. Compare

\# |2t |2v |4t |4v
---|:-:|:-:|:-:|:-:
2t | × | + | + | +
2v | × | × | + | +
4t | × | × | × | +
4v | × | × | × | ×

Notes: deferences are in txo_utxo (diff and/or add)

## 4. Partial x-load

Timing on 400k, D0=2015-01-01, D3=2051-12-31
Load, idx, queries 3m/6m/1y

- all/1y/6m/3m
- all/till/from/in
- D0: 2015-01-01
- D1: 2015-07-01
- D2: 2015-09-30
- D3: 2015-12-31

dir| D0 | D1 | T_ld |T_idx| Records   | T_y | T_6 | T_3
---|----|----|-----:|----:|----------:|----:|----:|----:
__ | -- | -- | 2502 | 881 | 220965455 | 351 | 354 | 350
\_3| -- | D3 | 2194 | 782 | 197546469 | 335 | 339 | 368
0_ | D0 | -- | 1807 | 498 | 133036600 | 239 | 265 | 228
03 | D0 | D3 | 1725 | 407 | 109617614 | 233 | 238 | 201
13 | D1 | D3 | 1500 | 273 |  71790360 | --- | 225 | 180
12 | D1 | D2 | 1328 | 138 |  40353931 | --- | --- | 138

03: 162488194 &rArr; 109617614 recs (1.5:1)

## 5. 670k

Act |tbl| t, m's" | Size,M | t, s  | size,M |
----|:-:|--------:|-------:|------:|-------:|
ld  | a |  25'08" |  63558 |  1508 |  63558
ld  | b |   0'08" |  63586 |     8 |     28
ld  | t |  21'01" | 127652 |  1261 |  64066
ld  | v |  32'41" | 209257 |  1961 |  81605
idx | a |  20'32" | 242766 |  1232 |  33509
idx | b |   0'01" | 242804 |     1 |     38
idx | t |  21'43" | 269166 |  1303 |  26362
idx | v | 206'55" | 445558 | 12415 | 176392
xld | x | 220'44" | 506410 | 13244 |  60852
idx | x |  60'21" | 611813 |  3621 | 105403

Summary:

- load+idx:  19689"=5:28'9" (445558=435GB)
- xload+idx: 16865"=4:41'5" (166255=162GB)

xload 2021-01-10..2021-02-10:

- T_ld: 73'17"
- T_idx: 7'25"
- Recs: 79003101
- tmp: 53GB

1kbk (670r):

Type | qty
-----|--------:
bk   |     1000
tx   |  2176448
vin  |  6145616
vout |  6608159
addr |  6559044
Uaddr|  3652861
SUMM | 25143128
